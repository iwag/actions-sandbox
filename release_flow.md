## リリースフロー

### 目的

* main を基準としたシンプルなリリースフローを定義する
* 自動化と人の判断ポイントを明確に分離する
* 「今どこまで進んでいるリリースか」を誰でも追えるようにする

---

## ブランチ構成

| ブランチ                | 役割                    |
| ------------------- | --------------------- |
| `main`              | 開発の基準ブランチ             |
| `release/candidate` | 次回リリース候補をまとめるブランチ（常設） |

### ルール

* feature / fix ブランチは **必ず main から作る**
* `release/candidate` への **直接コミットは禁止**
* 修正が必要な場合は main に入れて、再度リリース PR を作る

---

## 全体フロー概要

```
feature → main
   ↓（merge）
[自動]
main → release/candidate のリリースPR作成
   ↓（人が確認してmerge）
release/candidate 更新
   ↓（人が判断して実行）
tag 作成（＝正式リリース）
```

---

## 1. 開発者の通常作業

1. feature / fix ブランチを main から作成
2. PR を作成し、レビュー後 main に merge

ここまでは通常の開発フローと同じ。

---

## 2. main マージ後（自動）

main に PR が merge されると、GitHub Actions が自動で以下を行う：

* `release/candidate` ブランチが存在しなければ作成
* main との差分を元に **リリース PR** を作成
  （main → release/candidate）

この PR には：

* 今回のリリースに含まれる変更一覧
* リリースノート（候補）

が自動生成される。

---

## 3. リリース PR の扱い（人の作業）

### 目的

* 「この内容でリリースしてよいか」を確認するための PR

### 作業手順

1. 作成されたリリース PR を開く
2. PR 本文（リリースノート）を確認

   * 含まれる変更が意図どおりか
   * 抜け漏れがないか
3. 問題なければ **merge**

### 注意

* close はしない（release/candidate が更新されない）
* 修正が必要な場合：

  * main に修正 PR を入れる
  * 次のリリース PR に反映される

---

## 4. release/candidate の意味

* `release/candidate` の HEAD は
  **「次にリリースしてもよい状態」**
* ここに直接修正は入れない
* 状態はリリース PR の merge によってのみ更新される

---

## 5. 正式リリース（tag 作成）

### いつやるか

* リリース PR が merge され
* 「この状態をリリースする」と判断したとき

### 作業手順

1. GitHub Actions の **Create release tag** workflow を手動実行
2. tag 名を入力（例: `v1.2.3`）
3. 実行

これにより：

* `release/candidate` の現在の commit に tag が付与される
* GitHub Release が自動作成される
* GitHub Web の `Releases` ページで内容が確認できる

---

## 6. リリースノートについて

* リリースノートは **リリース PR の本文**で管理する
* tag 作成時には、その内容が GitHub Release として可視化される
* 二重管理はしない

---

## 7. よくある注意点

### Q. release/candidate に直接修正したい

→ ❌ 禁止
→ 修正は必ず main に入れる

### Q. リリース PR を merge し忘れたら？

→ tag を打つ前に、最新のリリース PRが merge 済みか確認する

### Q. tag を打ち間違えたら？

→ tag を削除してやり直す（運用ルールに従う）

---

## 8. このフローのメリット

* main 一本で分かりやすい
* 自動化は単純、判断は人間
* 「今どこまで進んでいるか」が GitHub 上で見える
* 将来の拡張（バージョニング・自動化）も可能

---

## 9. まとめ（超要約）

* main が唯一の基準
* リリース PR = 内容確認
* release/candidate = リリース候補
* tag = 正式リリース

---

**ここまでが正式なリリースフロー定義です。**

---

### 次にやるとしたら（任意）

* この内容を図にする（1枚）
* README / Notion に貼る
* merge 権限者を明示する

必要なら
**「図解版（1ページ）」**
**「さらに短い運用ルール版」**
も作れます。

